<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Turtle Drawing — Mobile Friendly</title>
  <style>
    :root{
      --bg:#0b0b0b; --panel:rgba(0,0,0,0.55); --text:#fff; --muted:#ddd;
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family:Inter, Arial, sans-serif; touch-action: manipulation;}
    .app{width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;}
    .canvas-wrap{position:relative;width:100vw;height:100vh;max-width:1360px;max-height:768px;}
    canvas{display:block;width:100%;height:100%;background:#000;}
    .top-instructions{position:absolute;top:12px;left:50%;transform:translateX(-50%);color:var(--text);background:var(--panel);padding:8px 12px;border-radius:8px;font-size:14px;font-weight:600;white-space: nowrap;}
    .status-panel{position:absolute;top:64px;left:16px;display:flex;flex-direction:column;gap:8px;background:var(--panel);padding:10px;border-radius:8px;color:var(--text);font-size:14px;min-width:160px;}
    .status-row{display:flex;justify-content:space-between;gap:8px;color:var(--muted);}
    .status-row span.value{font-weight:700;color:var(--text);}
    .text-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:50;}
    .text-panel{background:#111;padding:18px;border-radius:10px;color:#fff;display:flex;gap:8px;align-items:center;flex-direction:column;}
    .text-panel input[type="text"]{padding:10px;background:#222;border:1px solid #333;color:#fff;border-radius:8px;min-width:200px;outline:none;width:80%;}
    .text-panel button{padding:10px 12px;border-radius:8px;border:none;background:#1976d2;color:#fff;cursor:pointer;font-weight:600;width:80%;margin-top:6px;}
    .mobile-controls{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;flex-wrap:wrap;gap:6px;justify-content:center;}
    .mobile-button{padding:12px 16px;background:var(--panel);border:none;color:var(--text);border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;}
    @media (max-width:720px){.status-panel{left:8px;top:8px;font-size:13px}.top-instructions{font-size:12px;padding:6px}}
  </style>
</head>
<body>
  <div class="app">
    <div class="canvas-wrap" id="canvasWrap">
      <div class="top-instructions" id="instructions">Controls: WASD = Move | Space = Pen | C = PenColor | B = BGColor | V = FillColor | F = Fill | Z = Undo | R = Reset | T = Text | K = Square | M = Speed | N = SnapLock</div>

      <div class="status-panel" id="statusPanel"></div>
      <canvas id="turtleCanvas" width="800" height="600"></canvas>

      <div class="mobile-controls" id="mobileControls">
        <button class="mobile-button" data-action="up">↑</button>
        <button class="mobile-button" data-action="down">↓</button>
        <button class="mobile-button" data-action="left">←</button>
        <button class="mobile-button" data-action="right">→</button>
        <button class="mobile-button" data-action="pen">Pen</button>
        <button class="mobile-button" data-action="text">Text</button>
        <button class="mobile-button" data-action="undo">Undo</button>
        <button class="mobile-button" data-action="clear">Clear</button>
      </div>

      <div id="textOverlay" class="text-overlay" style="display:none;">
        <div class="text-panel">
          <input id="textField" type="text" placeholder="Enter text to draw..." maxlength="80" />
          <button id="drawTextBtn">Draw</button>
          <button id="cancelTextBtn" style="background:#6b7280;">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const canvas = document.getElementById('turtleCanvas');
    const ctx = canvas.getContext('2d');
    const CANVAS_W = 800, CANVAS_H = 600;

    function resizeCanvas(){
      const rect = canvas.getBoundingClientRect();
      canvas.width = CANVAS_W; canvas.height = CANVAS_H;
      canvas.style.width = rect.width + 'px'; canvas.style.height = rect.height + 'px';
    }
    window.addEventListener('resize', resizeCanvas); resizeCanvas();

    const $ = id => document.getElementById(id);

    const State = {x:CANVAS_W/2,y:CANVAS_H/2,heading:0,speed:5,is_pen_down:true,pen_color:'white',pen_size:4,paths:[],polygons:[],text_elements:[],bg_color:'black',fill_color:'white',is_filling:false,fill_points:[],text_input_visible:false,snap_lock:false,pressed_keys:new Set(),COLOR_CYCLE:['white','red','blue','green','yellow','orange','purple','cyan','magenta','lime','pink','teal'],BG_COLOR_CYCLE:['black','darkslateblue','darkgreen','maroon','indigo','saddlebrown','#333333'],SPEED_CYCLE:[5,10,25,50,75,100]};
    let typingText=false;

    function updateStatus(){
      $('statusPanel').innerHTML = `
        <div class='status-row'>Pen: <span class='value'>${State.is_pen_down?'DOWN':'UP'}</span></div>
        <div class='status-row'>Pen Color: <span class='value'>${State.pen_color}</span></div>
        <div class='status-row'>Fill: <span class='value'>${State.is_filling?'ON':'OFF'}</span></div>
        <div class='status-row'>Fill Color: <span class='value'>${State.fill_color}</span></div>
        <div class='status-row'>Speed: <span class='value'>${State.speed}</span></div>
        <div class='status-row'>Snap Lock: <span class='value'>${State.snap_lock?'ON':'OFF'}</span></div>
      `;
    }

    function rad(deg){return deg*Math.PI/180;}
    function moveForward(){const r=rad(State.heading); const newX=State.x+State.speed*Math.cos(r); const newY=State.y-State.speed*Math.sin(r); if(State.is_pen_down){State.paths.push({start:{x:State.x,y:State.y},end:{x:newX,y:newY},color:State.pen_color,size:State.pen_size});} if(State.is_filling) State.fill_points.push({x:State.x,y:State.y}); State.x=newX; State.y=newY;}
    function moveBackward(){const r=rad(State.heading); const newX=State.x-State.speed*Math.cos(r); const newY=State.y+State.speed*Math.sin(r); if(State.is_pen_down){State.paths.push({start:{x:State.x,y:State.y},end:{x:newX,y:newY},color:State.pen_color,size:State.pen_size});} if(State.is_filling) State.fill_points.push({x:State.x,y:State.y}); State.x=newX; State.y=newY;}
    function turnLeft(){State.heading=(State.heading+(State.snap_lock?45:15))%360;}
    function turnRight(){State.heading=(State.heading-(State.snap_lock?45:15)+360)%360;}

    // text input
    const textOverlay=$('textOverlay'),textField=$('textField'),drawTextBtn=$('drawTextBtn'),cancelTextBtn=$('cancelTextBtn');
    function showTextInput(){textOverlay.style.display='flex'; textField.value=''; textField.focus(); typingText=true;}
    function hideTextInput(){textOverlay.style.display='none'; typingText=false;}
    drawTextBtn.addEventListener('click',()=>{const txt=textField.value.trim(); if(txt.length>0) State.text_elements.push({content:txt,x:State.x,y:State.y,color:State.pen_color}); hideTextInput();});
    cancelTextBtn.addEventListener('click',hideTextInput);

    // mobile controls
    document.querySelectorAll('.mobile-button').forEach(btn=>{
      btn.addEventListener('touchstart',()=>{
        const action=btn.dataset.action;
        if(action==='up') moveForward();
        else if(action==='down') moveBackward();
        else if(action==='left') turnLeft();
        else if(action==='right') turnRight();
        else if(action==='pen') State.is_pen_down=!State.is_pen_down;
        else if(action==='text') showTextInput();
        else if(action==='undo' && State.paths.length>0) State.paths.pop();
        else if(action==='clear'){State.paths=[]; State.polygons=[]; State.text_elements=[];}
        updateStatus();
      });
    });

    function draw(){
      ctx.save(); ctx.fillStyle=State.bg_color; ctx.fillRect(0,0,CANVAS_W,CANVAS_H);
      for(const poly of State.polygons){if(!poly.points) continue; ctx.beginPath(); ctx.moveTo(poly.points[0].x,poly.points[0].y); for(let i=1;i<poly.points.length;i++) ctx.lineTo(poly.points[i].x,poly.points[i].y); ctx.closePath(); ctx.fillStyle=poly.color; ctx.fill();}
      for(const p of State.paths){ctx.beginPath(); ctx.moveTo(p.start.x,p.start.y); ctx.lineTo(p.end.x,p.end.y); ctx.lineWidth=p.size; ctx.lineCap='round'; ctx.strokeStyle=p.color; ctx.stroke();}
      ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.font='16px Arial';
      for(const t of State.text_elements){ctx.fillStyle=t.color; ctx.fillText(t.content,t.x,t.y);}
      drawTurtle(); ctx.restore(); requestAnimationFrame(draw);
    }
    function drawTurtle(){ctx.save(); ctx.translate(State.x,State.y); ctx.rotate((90-State.heading)*Math.PI/180); ctx.beginPath(); ctx.moveTo(0,-12); ctx.lineTo(10,8); ctx.lineTo(-10,8); ctx.closePath(); ctx.fillStyle=State.pen_color; ctx.fill(); ctx.restore();}
    requestAnimationFrame(draw); updateStatus();
  })();
  </script>
</body>
</html>
